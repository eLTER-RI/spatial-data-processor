# Installation
This guide describes the intended setup process to go from a fresh repository to a working installation.

## Prerequisites
- Ubuntu 20.04 LTS or other Linux/BSD OS (see below)
- R 4.0.4
    - the packrat module to manage R dependencies
- Python 3.8.5
    - the venv module to manage Python dependencies
- a compatible libpython shared library (installing python3-dev on Linux distributions should ensure this - see [this GitHub issue](https://github.com/rstudio/reticulate/issues/637))
- internet access to install Python and R dependencies

The only supported operating system is Ubuntu 20.04 LTS, although other Linux/BSDs are likely to work.
macOS and Windows are more uncertain but may work.

## Version policy
The current policy is to support only the specific versions of R and Python stated above, as well as the specific dependencies described in `requirements.txt` and `packrat/packrat.lock`. Older versions of Python and R likely will not work due to dependencies, while newer versions may work despite being unsupported.

For now, the sole supported versions of R and Python will be updated to match the newest versions in [DataLabs](https://datalab.datalabs.ceh.ac.uk/) as they become available.

## Process
With the repository cloned to the target machine, from the repository root:

- create directories `input` and `output`, each containing directories `wf1` and `wf2` (these subdirectories must be writeable by the Shiny process)
- source `setup.R` in an R session to restore the Packrat environment from the dependencies specified in `packrat/packrat.lock` into the `packrat` directory
- create a virtual environment called `reticulate-venv`
- install Python dependencies from `requirements.txt` into this virtual environment

A small bash script, `setup.sh`, is provided to automate these steps.  
**WARNING**: only run this script *from the root of the repository*.

A separate script, `datalabs-setup.sh`, is provided for setup within the DataLabs RStudio images, where additional steps are required for installation.  
**WARNING**: only run this script *from the root of the repository*.

Finally, `clear-data.sh` is provided to quickly clear all data uploaded to and generated by the system.  
**WARNING**: only run this script *from the root of the repository*.  
**WARNING**: data is deleted *without prompting for confirmation*.

All three of these scripts are only supported on Ubuntu 20.04 LTS.

## Running
After installation, app.R can be treated as any other Shiny deployment, although the Shiny process must run in the same directory as app.R as filesystem access is done relatively.
Running `Rscript app.R` will start a server on a random port, suitable for development.
